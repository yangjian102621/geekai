# 更新日志

## 4.0.2

* 功能新增：支持前端菜单可以配置
* 功能优化：在登录和注册界面标题显示软件版本号
* 功能优化：MJ 绘画支持 --sref 和 --cref 图片一致性参数
* 功能优化：使用 leveldb 解决 SD 绘图进度图片预览问题
* Bug修复：解决因为图片上传使用相对路径而导致融图失败的问题
* 功能新增：手机端支持 Stable-Diffusion 绘画
* Bug修复：修复管理后台 API KEY 删除失败的问题

## v4.0.1

* 功能重构：重构 Stable-Diffusion 绘画实现，使用 SDAPI 替换之前的 websocket 接口，SDAPI 兼容各种 stable-diffusion
  发行版，稳定性更强一些
* 功能优化：使用 [midjouney-proxy](https://github.com/novicezk/midjourney-proxy) 项目替换内置的原生 MidJourney API，兼容
  MJ-Plus 中转
* 功能新增：用户算力消费日志增加统计功能，统计一段时间内用户消费的算力
* Bug修复：修复 iphone 手机无法通过图形验证码的Bug，使用滑动验证码替换
* Bug修复：修复手机端 MidJourney 绘画页面滚动条无法滚动的Bug

## v4.0.0

非兼容版本，重大重构，引入算力概念，将系统中所有的能力（AI对话，MJ绘画，SD绘画，DALL绘画）全部使用算力来兑换。
只要你的算力值余额不为0，你就可以进行任何操作。比如一次 GPT3.5 对话消耗1个单位算力，一次 GPT4 对话消耗10个算力。一次 MJ
对话消耗15个算力...

* 功能重构：重构整体系统，全部采用算力来进行结算
* 功能优化：SD 绘画页面采用 websocket 替换 http 轮询机制，节省带宽
* 功能优化：移动端聊天页面图片支持预览和放大功能
* 功能优化：MJ 和 SD 页面数据分页加载，解决一次性加载太多数据导致页面卡顿的问题
* 功能优化：**PC端不登录也可以预览功能，只有在发起操作的时候才需要登录**
* 功能优化：控制台订单管理页面显示未支付订单，并提供订单删除功能
* 功能新增：支持H5支付
* 功能优化：支持数学公式的识别和美化输出
* 功能新增：新增算力消费日志功能
* 功能优化：整合 XXL-JOB 实现订单清理，每日算力派发，VIP 算力重置等任务
* 功能新增：管理后台新增7日内新增用户和新增订单统计

## v3.2.7

* 功能重构：采用 Vant 重构移动页面，新增 MidJourney 功能
* 功能优化：优化 PC 端 MidJourney 页面布局，新增融图和换脸功能
* Bug修复：修复 issue [
  管理界面操作用户存在的两个问题](https://github.com/yangjian102621/chatgpt-plus/issues/117#issuecomment-1909201532)
* 功能优化：在对话和聊天记录表中新增冗余字段 model，存储对话模型
* Bug修复：IPhone 手机验证码触摸事件坐标错位 [issue 144](https://github.com/yangjian102621/chatgpt-plus/issues/144)
* Bug修复：重新生成按钮功能失效问题
* Bug修复：对话输入HTML标签不显示的问题
* 功能优化：gpt-4-all/gpts/midjourney-plus 支持第三方平台的 API KEY
* 功能新增：新增删除文件功能
* Bug修复：解决 MJ-Plus discord 图片下载失败问题，使用第三方平台中转地址下载
* 功能新增：后台管理新怎对话查看和检索功能

## v3.2.6

* 功能优化：恢复关闭注册系统配置项，管理员可以在后台关闭用户注册，只允许内部添加账号
* 功能优化：兼用旧版本微信收款消息解析
* 功能优化：优化订单扫码支付状态轮询功能，当关闭二维码时取消轮询，节约网络资源
* 功能新增：新增图片发布功能，画廊只显示用户已发布的图片
* 功能新增：后台新增配置微信客服二维码，可以上传自己的微信客服二维码
* 功能新增：新增网站公告，可以在管理后台自定义配置
* 功能新增：新增阿里通义千问大模型支持
* Bug修复：修复 MJ 放大任务失败时候 img_call 会增加的 Bug
* 功能优化：新增虎皮椒和PayJS订单状态校验功能，增加安全性
* Bug修复：修复微信转账交易 ID 提取失败 Bug
* 功能优化：给所有的 websocket 连接加上心跳，解决 "close 1006 (abnormal closure): unexpected EOF" Bug
* 功能新增：新增短信宝短信平台发送平台集成

## v3.2.5

* 功能新增：**重磅更新！！！** 新增 MidJourney-Plus API 支持，一秒配置，开箱即用，高效稳定。
* 功能新增：**重磅更新！！！** 新增 GPT4-ALL 和 GPTs 模型支持，你只需花几块钱，可以丝滑享受 ChatGPT-Plus 会员的所有功能，无需再订阅
  Plus 账号了！！！
* 功能优化：增强 markdown 图片和引用块解析。
* 功能新增：新增用户文件管理，目前一支持上传文件跟 GPT 进行多态对话。
* 功能优化：function call 兼用中转 API。
* Bug修复：修复部分已知的 Bug。

## v3.2.4.1

* 功能新增：新增 PayJs 支付通道
* Bug修复：紧急修复后台添加用户失败问题
* Bug修复：紧急修复使用中转 API-KEY 无法绘图的问题
* Bug修复：允许用户关闭手机和邮箱注册通道，移除验证码依赖

## v3.2.4

* 功能新增：重磅更新，支持邮箱注册
* 功能优化：优化函数调用授权
* 功能优化：给用户表新增 nickname 字段
* 功能优化：管理后台给聊天角色增加启用/禁用开关
* Bug修复：SD绘画出现重复扣减绘图次数
* 功能优化：优化聊天对话导出样式，适应移动端
* 功能新增：众筹核销可以选择兑换对话还是绘图的额度
* Bug修复：修复[从历史记录获取reply有并发风险 #92](https://github.com/yangjian102621/chatgpt-plus/issues/92)
* Bug修复：修复 MidJourney 绘图任务调度Bug，为 task_id 建议唯一索引
* 功能重构：重构了 API KEY模块，支持为每个 API KEY 都设置不同的 API 地址，并可以单独开启是否使用代理。

## v3.2.3

* 功能重构：重构函数工具模块，设计成可以后台动态管理函数。支持添加自定义函数实现
* 功能新增：为充值产品数据表添加 img_calls 字段，支持充值绘图次数
* Bug修复：修复 [MJ 机器人空指针异常的 Bug](https://github.com/yangjian102621/chatgpt-plus/issues/73)
* Bug修复：确保相同 Prompt 的绘图任务的 Upscale 和 Variation 任务调度给相同的频道
* 功能新增：新增删除绘图任何和图片功能
* Bug修复：修复虎皮椒支付二维码重复扫码时报错问题
* 功能优化：自动将 AI 绘画中的中文提示词翻译成英文
* 功能优化：优化AI绘画的大图压缩算法，新增图片缓存
* 功能优化：支持为 MJ 绘图 API 增加反代功能，提高图片的加载速度，大大降低绘图任务的失败率
* Bug修复：修复[Azure Api 更换api-version参数后请求失败的问题](https://github.com/yangjian102621/chatgpt-plus/pull/71)
* Bug修复：修复科大讯飞 V1.5 API 请求失败的问题
* Bug修复：绘图失败后，自动恢复用户的剩余绘图次数
* 功能新增：为移动端新增 SD 绘图功能，分享功能

## v3.2.2

* 功能重构：重构 MidJourney 和 Stable-Diffusion 绘图模块，支持使用多组配置创建池子提供绘画服务
* 功能新增：AI绘画页面增加翻译和重写提示词功能
* 功能优化：OSS上传组件支持在 Bucket 下设置二级目录
* Bug修复：修复阿里云 OSS 访问路径错误
* 功能优化：在 AI 绘图页面使用 HTTP 轮询替换 Websocket

## v3.2.1

* 功能优化：切换角色和模型的时候自动创建新的对话
* Bug修复：修复文件上传失败No such file bug
* 功能新增：MidJourney 绘画页面新增提示词翻译功能，新增多个绘画参数
* Bug修复：[PC端对话在刷新后异常](https://github.com/yangjian102621/chatgpt-plus/issues/59)
* 功能新增：增加 arm64 架构打包脚本
* 功能新增：支持 dall-e3 绘图的 API 地址自定义配置
* 功能新增：新增虎皮椒支付功能接入，支持微信和支付宝通道

## v3.2.0

* 功能新增：新增邀请注册功能
* 功能优化：增加中间件自动对HTTP请求的参数去掉首尾空格
* 功能优化：增加中间件自动为大图片生成缩略图
* 功能优化：MidJourney 页面图片加载优化，实现图片预览懒加载
* 功能新增：新增 DALL-E-3 绘画支持，并作为对话页面默认绘画插件
* Bug修复：修复阿里云 OSS 域名设置不起做用的bug
* Bug修复：修复MidJourney绘图失败后重复添加到队列的问题

## v3.1.9

* 功能新增：增加讯飞星火大模型 v3.0 支持
* 功能新增：新增找回密码功能
* 功能新增：支持 Markdown 代码复制功能
* Bug修复: xxl-job 任务调度失败的 Bug
* 功能优化：优化前端页面菜单图标，使用自定义图标替换 icon-font
* Bug修复：Stable-Diffusion 绘画成功之后没有扣减用户画图次数
* 功能优化：优化会员充值页面 ItemList 组件
* 功能优化：给首页 Logo 增加链接
* Bug修复：[新建会话时，提示"请输入合法的手机号" ](https://github.com/yangjian102621/chatgpt-plus/issues/51)
* Bug修复：聊天上下文失效问题
* 功能优化：关闭注册时显示联系管理员二维码
* 功能优化：移除 leveldb 依赖，使用 redis 替换相应的功能
* Bug修复：后台启用用户 VIP 不生效问题
* 功能优化：充值支付页面的支付说明文字可以后台配置
* Bug修复：ChatGLM，百度文心，科大讯飞模型输出代码不换行问题

## v3.1.8

1. 功能新增：新增会员套餐充值，点卡充值，订单系统，集成支付宝支付通道
2. Bug修复：修复 MidJourney API 参数版本更新导致调用失败问题
3. Bug修复：修复 Stable Diffusion 调用后没有更新绘图调用次数问题
4. Bug修复：修复七牛云上传报错 expired token
5. Bug修复：修复高权重模型导致的对话次数为负数的漏洞
6. 功能优化：将聊天报错信息定义为统一常量，方便修改
7. 功能优化：优化 markdown 表格显示样式，覆写 Element-Plus 表格样式
8. 功能优化：增加倒数计时组件，定期自动清理未支付的订单

## v3.1.7

1. 功能新增：支持文心4.0 AI 模型
2. 功能新增：可以在管理后台为用户绑定指定的 AI 模型，如只给某个用户使用 GPT-4 模型
3. 功能新增：模型新增权重字段，不同的模型每次调用耗费的点数可以设置不同，比如GPT4是GPT3.5的10倍
4. 功能新增：新增系统配置关闭 AI 模型的函数功能
5. 功能优化：优化 MidJourney 专业绘画页面图片预览样式

## v3.1.6

1. 功能新增：新增AI 绘画照片墙功能页面，供用户查看所有的 AI 绘画作品
2. 功能新增：新增 AI 角色应用功能页面，用户可以添加自己感兴趣的应用
3. 功能优化：优化瀑布流组件的页面布局
4. 功能优化：新注册用户成功之后自动登录
5. 功能优化：优化更新对话标题的操作体验，绑定回车事件

## v3.1.5

1. 功能新增：新增百度文心一言大模型 API 接入支持
2. 功能新增：新增科大讯飞星火大模型 API 接入支持
3. 功能重构：将 chat_handler 的所有功能实现放入单独的包中
4. 功能新增：新增系统配置 `enabled_function` 用于启用和关闭函数功能
5. Bug修复：修复管理后台更新 API Key 失败的 Bug
6. Bug修复：修复新建的对话无法更新对话标题的 Bug
7. 功能优化：其他一些小的体验优化工作

## v3.1.4

1. 功能新增：新增阿里云 OSS 图片上传实现，目前已支持本地存储，七牛云，Minio和阿里云 OSS 四种存储介质。
2. 功能新增：**增加 Stable Diffusion 绘画功能页面**。
3. 功能重构：将 [chatgpt-plus-exts](https://github.com/yangjian102621/chatgpt-plus-exts) 合并到本项目，部署更加简单，无需部署两个项目了。
4. Bug修复：修复[用户注册报错BUG #37](https://github.com/yangjian102621/chatgpt-plus/issues/37)。
5. Bug修复：修复 MidJourney API 接口升级导致图片文保存失败的 Bug。
6. 功能优化：增加阿里云短信服务配置项 `Sign` 和 `CodeTempId` 用来配置自己的短信签名和短信验证码模版 ID。
7. 功能优化：添加系统配置用来设置自定义的众筹微信收款二维码。
8. 功能优化：优化绘画页面的弹窗样式和页面布局。

## v3.1.3

1. 页面重构：重后 Home 页面，拆分成聊天，MJ绘画，SD 绘画，应用广场等多个功能菜单。
2. 功能新增：新增 MidJourney 专业绘画页面，开放更高级的 MJ 绘画姿势。
3. 功能优化：采用队列的方式控制绘画任务并发，简化任务回调通知逻辑，给任务回调加锁。
4. 功能优化：精简用户表字段，删除用户名和昵称，只保留手机号。
5. 功能优化：优化文件上传服务工厂实现，只创建激活的 Uploader 服务，节省资源。
6. Bug修复：修复 JWT token 有效期计算错误的 Bug。

## v3.1.2

1. 功能新增：新增七牛云 OSS 实现，目前已支持三种文件上传服务：Local, Minio, QiNiu OSS。
2. 功能新增：新增桌面版，使用 electron 套壳网页版。
3. Bug修复：自动去除众筹核销时候转账单号中的空格，防止复制的时候多复制了空格。
4. 功能优化：ChatPlus.vue 页面支持通过 chat_id path variable 来定位到指定的聊天。
5. 功能优化：取消导出聊天页面的授权验证
6. 功能优化：所有路由跳转都使用绝对路径

## v3.1.1

紧急修复版本，采用弹窗的方式显示验证码，解决验证码在低分辨率下被掩盖的Bug

## v3.1.0(大版本更新)

1. 功能重构：将聊天模型独立拆分，以便支持多平台模型，目前已经内置支持 OPenAI，Azure 以及
   ChatGLM，用户可以在这两个平台的模型中随意切换，体验不同的模型聊天。
2. 功能重构：重写系统 API 授权机制，使用 JWT 替换传统的 session 会话授权，使得 API 授权变得更加灵活。
3. 功能重构：重构文件夹上传服务，支持多种文件上传存储handler，目前已经实现本地存储和 minio oss 存储。
4. 功能优化：更新头像自动删除旧的图片资源。
5. 功能优化：将应用日志在终端输出的同时存盘，方便 docker 部署查看日志。
6. 功能新增：允许用户配置自己的 OPenAI，Azure 以及 ChatGLM API KEY。
7. 功能优化：优化移动版的行为验证码样式，修复低分辨率显示器验证码被遮挡的 Bug
8. 升级 gin, element-plus，redis 组件到最新版本。
9. Bug修复：修复若干已知的的 Bug

## v3.0.7

1. 聊天主界面：新增聊天引导页面，介绍产品功能
2. 功能重构：拆分项目，将函数插件以及微信机器人，MidJourney 机器人等功能拆分新项目独立部署。
3. 功能新增：新增 MidJourney AI 绘画支持，当识别到用户的绘画需求时，自动调用 MidJourney 绘画函数进行绘画。
4. 功能新增：支持导出聊天记录为 PDF 文件。
5. 功能优化：在后台 dashboard 页面新增统计今日众筹收入。
6. 功能优化：支持用户设置默认的 GPT 模型
7. Bug修复：修复若干已知的的 Bug

## v3.0.6

1. 管理后台：新增用户名和手机号码搜索功能
2. 管理后台：新增重置用户密码功能
3. 管理后台：支持关闭注册功能，新增添加用户功能，适用于内部使用场景
4. 管理后台：新增仪表盘页面，统计当天的新增用户，新增会话数据，以及 Token 消耗
5. Bug修复：修复注册页面验证码不显示 Bug
6. Bug修复：优化上下文 Token 计算算法，修复聊天上下文超出限制时循环发送消息的 Bug
7. 功能修正：允许用户使用手机号码登录
8. 功能优化：更新系统配置后同步更新服务端内存变量数据
9. 功能优化：优化打包脚本，减少容器镜像大小

## v3.0.5

重磅功能更新！！！ 新增函数插件支持，可以轻松地接入你的第三方插件服务，ChatGPT 自动帮您调用对应的函数完成任务。

1. 新增函数功能支持，全球早报，今日头条和微博热搜等插件服务，您也可以接入自己的第三方服务。
2. 集成微信机器人模块，可以通过微信个人收款码来完成充值，无需接入微信支付功能也可以完成收款功能。
3. 用户注册添加短信验证码功能，引入交互安全认证服务，有效防刷短信。
4. 支持配置聊天上下文深度，精确统计每轮对话所消耗的总 TOKEN 数量。
5. 修复已知的 Bug。

## v3.0.4

1. 调整项目目录结构，移除其他语言 API 目录
2. 修复 nodejs apple M1 跨平台打包，运行报错 exec format error
3. 增加用户 token 消耗统计功能

## v3.0.3

1. 优化启动参数接收处理，支持环境变量传参
2. 修复 PC 端聊天界面出现滚动条的 Bug
3. 修正前端 user_init_call 字段错误和用户注册初始化头像路径问题
4. 更改 docker 构建镜像的基础镜像，改用作者的阿里云镜像，这样打包更快一些。

## v3.0.2

1. Feat：新增移动端的聊天和用户设置功能
2. Fix: 修复 markdown 换行符解析的 Bug
3. Feat: 新增头像上传功能
4. Docs: 增加容器部署支持，支持 docker-compose 一键部署
5. Fix: 增加全局错误处理 handler，修复业务处理异常导致服务退出的 Bug

## v3.0.1

1. 紧急修复前端 Home 组件路由被后台管理 Home 组件路由覆盖的 Bug。
2. 增加 docker-compose 部署脚本

## v3.0.0

全新的重构版本！！！
新版的系统前后端都进行大改动的重构，后端还是用的 Gin Web 框架，但是作者整合了 fx 自动注入框架，整个后端应用结构非常简洁，特别适合二次开发。
另外，数据存储用 MySQL 替换了 leveldb, 因为要对 C 端，后期会涉及到很多业务数据查询统计，leveldb 已经完全不够用了。
前后台技术架构还是基于 `Vue3 + Element-Plus` ，但是页面风格已经全部变了，几乎所有页面样式代码都重写了，希望会你是希望的风格！

此次重构改版主要是为了后面功能的扩展准备了。

新版本已经实现的功能如下：

1. 引入用户体系，新增用户注册和登录功能。
2. 聊天页面改版，实现了跟 ChatGPT 官方版本一致的聊天体验。
3. 创建会话的时候可以选择聊天角色和模型。
4. 新增聊天设置功能，用户可以导入自己的 API KEY
5. 保存聊天记录，支持聊天上下文。
6. 重构后台管理模块，更友好，扩展性更好的后台管理系统。
7. 引入 ip2region 组件，记录用户的登录IP和地址。
8. 支持会话搜索过滤。